<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="创建EMQX的认证和授权表" author="zhengchalei">
        <sql>
            CREATE TABLE mqtt_user (
                id SERIAL primary key,
                is_superuser boolean,
                username character varying(100),
                password_hash character varying(100),
                salt character varying(40)
            );

            CREATE TYPE ACTION AS ENUM('publish','subscribe','all');
            CREATE TYPE PERMISSION AS ENUM('allow','deny');

            CREATE TABLE mqtt_acl (
                id SERIAL PRIMARY KEY,
                ipaddress CHARACTER VARYING(60) NOT NULL DEFAULT '',
                username CHARACTER VARYING(255) NOT NULL DEFAULT '',
                clientid CHARACTER VARYING(255) NOT NULL DEFAULT '',
                action ACTION,
                permission PERMISSION,
                topic CHARACTER VARYING(255) NOT NULL
            );
        </sql>
    </changeSet>

    <changeSet id="创建Device表" author="zhengchalei">
        <createTable tableName="iot_device" remarks="系统Device表">
            <column name="id" type="BIGSERIAL" autoIncrement="true" remarks="主键">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="code" type="Text" remarks="Device名">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="name" type="Text" remarks="Device名">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="Text" remarks="Device名">
                <constraints nullable="true" unique="true"/>
            </column>
            <column name="online" type="Boolean" remarks="Device名">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="created_time" type="TIMESTAMP WITH TIME ZONE"
                    defaultValueComputed="CURRENT_TIMESTAMP"
                    remarks="创建时间">
                <constraints nullable="false"/>
            </column>
            <column name="modified_time" type="TIMESTAMP WITH TIME ZONE"
                    defaultValueComputed="CURRENT_TIMESTAMP"
                    remarks="更新时间" />
            <column name="created_by" type="BIGINT" remarks="创建人" />
            <column name="modified_by" type="BIGINT" remarks="更新人" />
        </createTable>
    </changeSet>

    
    <changeSet id="创建Product表" author="zhengchalei">
        <createTable tableName="iot_product" remarks="系统Product表">
            <column name="id" type="BIGSERIAL" autoIncrement="true" remarks="主键">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="code" type="Text" remarks="Product名">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="name" type="Text" remarks="Product名">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="Text" remarks="Product名">
                <constraints nullable="true" unique="true"/>
            </column>
            <column name="status" type="Boolean" remarks="Product名">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="created_time" type="TIMESTAMP WITH TIME ZONE"
                    defaultValueComputed="CURRENT_TIMESTAMP"
                    remarks="创建时间">
                <constraints nullable="false"/>
            </column>
            <column name="modified_time" type="TIMESTAMP WITH TIME ZONE"
                    defaultValueComputed="CURRENT_TIMESTAMP"
                    remarks="更新时间" />
            <column name="created_by" type="BIGINT" remarks="创建人" />
            <column name="modified_by" type="BIGINT" remarks="更新人" />
        </createTable>
    </changeSet>

</databaseChangeLog>